<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>CyberShield Field Kit | RomanoTI Solutions</title>

  <!-- ============================ [NEW] ============================ -->
  <!-- FAVICONS (RomanoTI unificados) -->
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16.png">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#2563eb">
  <meta name="theme-color" content="#2563eb">
  <!-- ========================== [/NEW] ============================ -->

  <!-- ============================ [REMOVED] ============================
  Favicon suelto anterior:
  <link rel="icon" href="/img/favicon.png" type="image/png"/>
  ============================ [/REMOVED] ============================= -->

  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --rt-primary:#2563eb;
      --rt-primary-hover:#1d4ed8;
      --rt-brand-deep:#1e3a8a;
      --rt-accent:#10b981;
      --rt-code:#0e1116;
    }
    body{font-family:'Montserrat',sans-serif}
    .btn-primary{background:var(--rt-primary);transition:all .2s}
    .btn-primary:hover{background:var(--rt-primary-hover);transform:translateY(-1px)}
    .badge{display:inline-block;border:1px solid #cbd5e1;border-radius:999px;padding:4px 10px;font-size:12px;background:#f8fafc}
    .card{border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 10px 30px -12px rgba(0,0,0,.12)}
    pre.fieldkit-out{background:var(--rt-code);color:#eaeef3;padding:12px;border-radius:10px;max-height:46vh;overflow:auto}
    .hidden{display:none}
    .muted{color:#94a3b8;font-style:italic}
  </style>
</head>
<body class="bg-gray-50 text-gray-900">

  <!-- ============================ [REMOVED] ============================
  Header/nav estÃ¡tico previo con dropdown duplicado
  <header class="bg-white shadow-md sticky top-0 z-50"> ... </header>
  ============================ [/REMOVED] ============================= -->

  <!-- ============================ [NEW] ============================ -->
  <!-- Mountpoint del HEADER unificado (inyectado por /js/nav.js) -->
  <div id="app-header"></div>
  <!-- ========================== [/NEW] ============================ -->

  <!-- Title / intro -->
  <section class="bg-white border-b">
    <div class="container mx-auto px-6 py-8">
      <h1 class="text-3xl font-bold">CyberShield Field Kit</h1>
      <p class="text-gray-600 mt-2">Chequeos rÃ¡pidos para demos y assessment inicial. Usa tu <code>x-api-key</code>.</p>
    </div>
  </section>

  <!-- API Key -->
  <section class="container mx-auto px-6">
    <div class="card bg-white p-6 mt-6">
      <label class="block text-sm font-medium text-gray-700 mb-1">Org API Key (<code>x-api-key</code>)</label>
      <div class="flex flex-col md:flex-row gap-3 items-start md:items-center">
        <div class="flex items-center gap-2 w-full md:w-auto">
          <input id="fkKey" type="password" class="w-[380px] max-w-full border rounded-lg px-3 py-2" placeholder="pega tu API key">
          <label class="text-sm text-gray-600 inline-flex items-center gap-1">
            <input id="fkKeyShow" type="checkbox" class="rounded border-gray-300">
            <span>mostrar</span>
          </label>
        </div>
        <div class="flex gap-3">
          <button id="btnSaveKey" class="btn-primary text-white px-5 py-2 rounded-lg font-medium">Guardar</button>
          <button id="btnClearKey" class="px-5 py-2 rounded-lg font-medium border">Clear</button>
        </div>
      </div>
      <p id="fkKeyMsg" class="text-sm text-gray-500 mt-2"></p>
    </div>
  </section>

  <section class="container mx-auto px-6 mt-6">
    <div class="grid md:grid-cols-2 gap-6">

      <!-- Left: External posture -->
      <div class="card bg-white p-6">
        <h2 class="text-xl font-bold mb-4">External Posture</h2>

        <!-- Domain -->
        <label class="block text-sm font-medium text-gray-700">Domain</label>
        <input id="fkDomain" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="example.com" value="example.com">

        <div class="flex flex-wrap gap-3">
          <button id="btnEmailPosture" class="btn-primary text-white px-4 py-2 rounded-lg font-medium">
            Email Posture (MX/SPF/DMARC)
          </button>
        </div>

        <!-- DKIM -->
        <div class="grid md:grid-cols-2 gap-3 mt-5">
          <div>
            <label class="block text-sm font-medium text-gray-700">DKIM selector</label>
            <input id="fkDkimSelector" class="w-full border rounded-lg px-3 py-2" placeholder="selector1">
          </div>
          <div class="flex items-end">
            <button id="btnDkim" class="btn-primary text-white px-4 py-2 rounded-lg font-medium w-full">DKIM TXT lookup</button>
          </div>
        </div>

        <!-- TLS -->
        <div class="grid md:grid-cols-6 gap-3 mt-6">
          <div class="md:col-span-4">
            <label class="block text-sm font-medium text-gray-700">TLS host</label>
            <input id="fkTlsHost" class="w-full border rounded-lg px-3 py-2" placeholder="example.com" value="example.com">
          </div>
          <div class="md:col-span-1">
            <label class="block text-sm font-medium text-gray-700">Port</label>
            <input id="fkTlsPort" type="number" min="1" max="65535" value="443" class="w-full border rounded-lg px-3 py-2">
          </div>
          <div class="md:col-span-1 flex items-end">
            <button id="btnTls" class="btn-primary text-white px-4 py-2 rounded-lg font-medium w-full">TLS Cert Check</button>
          </div>
        </div>

        <pre id="fkOutLeft" class="fieldkit-out hidden mt-4"></pre>
      </div>

      <!-- Right: Service check -->
      <div class="card bg-white p-6">
        <h2 class="text-xl font-bold mb-4">Service Check (host/url)</h2>

        <div class="grid md:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-gray-700">Host</label>
            <input id="fkHost" class="w-full border rounded-lg px-3 py-2" placeholder="8.8.8.8">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">URL (opcional)</label>
            <input id="fkUrl" class="w-full border rounded-lg px-3 py-2" placeholder="https://tu-sitio.com">
          </div>
        </div>

        <label class="block text-sm font-medium text-gray-700 mt-3">Puertos rÃ¡pidos (coma)</label>
        <input id="fkPorts" class="w-full border rounded-lg px-3 py-2" value="22,80,443,3389,445,25,587">

        <div class="mt-3">
          <button id="btnSvc" class="btn-primary text-white px-4 py-2 rounded-lg font-medium">Ejecutar</button>
        </div>

        <pre id="fkOutRight" class="fieldkit-out hidden mt-4"></pre>
      </div>
    </div>
  </section>

  <!-- ============================ [REMOVED] ============================
  Footer estÃ¡tico previo:
  <footer class="bg-gray-900 text-white py-8 mt-10"> ... </footer>
  ============================ [/REMOVED] ============================= -->

  <!-- ============================ [NEW] ============================ -->
  <!-- Mountpoint del FOOTER unificado (inyectado por /js/footer.js) -->
  <div id="app-footer" class="mt-10"></div>
  <!-- ========================== [/NEW] ============================ -->

  <!-- ============================ [REMOVED] ============================
  Script del dropdown del navbar (ya no se usa porque el header es centralizado):
  <script> (function(){ ... })(); </script>
  ============================ [/REMOVED] ============================= -->

  <!-- Field Kit logic (sin cambios funcionales) -->
  <script>
  (function(){
    const API_BASE = 'https://romanoti-tools-api.onrender.com';
    const $ = (id)=>document.getElementById(id);

    function showPlaceholder(preId, text='No output yet'){
      const el=$(preId); el.textContent=text; el.classList.remove('hidden'); el.classList.add('muted');
    }
    function showJSON(preId, data){
      const el=$(preId); el.classList.remove('muted','hidden');
      try{ el.textContent = JSON.stringify(data, null, 2); }catch{ el.textContent = String(data); }
    }
    function setBtnLoading(btn, isLoading, label){
      if(!btn) return;
      btn.disabled = !!isLoading;
      if(isLoading){ btn.dataset._label = btn.textContent; btn.textContent = label || 'Runningâ€¦'; }
      else { btn.textContent = btn.dataset._label || btn.textContent; }
    }
    function parsePorts(s){
      return (s||'').split(',').map(x=>x.trim()).filter(Boolean)
        .map(x=>parseInt(x,10)).filter(x=>Number.isInteger(x)&&x>0&&x<=65535).slice(0,50);
    }
    function getKey(){
      return $('fkKey').value.trim() || localStorage.getItem('romanoti_org_key') || '';
    }

    // Load/save/clear key
    (function initKey(){
      const saved = localStorage.getItem('romanoti_org_key') || '';
      if(saved) {$('fkKey').value = saved; $('fkKeyMsg').textContent='âœ… API key cargada desde tu navegador.';}
      $('fkKeyShow').addEventListener('change', (e)=>{ $('fkKey').type = e.target.checked ? 'text' : 'password'; });
      $('btnSaveKey').addEventListener('click', ()=>{
        const v=$('fkKey').value.trim(); localStorage.setItem('romanoti_org_key', v);
        $('fkKeyMsg').textContent = v ? 'âœ… Guardada localmente.' : 'API Key vacÃ­a.';
      });
      $('btnClearKey').addEventListener('click', ()=>{
        localStorage.removeItem('romanoti_org_key'); $('fkKey').value=''; $('fkKeyMsg').textContent='ðŸ”’ Key eliminada del navegador.';
      });
    })();

    // Email posture
    $('btnEmailPosture').addEventListener('click', async ()=>{
      const key=getKey(); if(!key){alert('Ingresa tu Org API Key');return;}
      const domain=$('fkDomain').value.trim(); if(!domain){showJSON('fkOutLeft',{error:'Ingresa domain'});return;}
      setBtnLoading($('btnEmailPosture'), true);
      showPlaceholder('fkOutLeft','Runningâ€¦');
      try{
        const res = await fetch(`${API_BASE}/ext/emaildns`, {
          method:'POST',
          headers:{'x-api-key':key,'content-type':'application/json','accept':'application/json'},
          body: JSON.stringify({ domain })
        });
        const data = await res.json();
        showJSON('fkOutLeft', data);
      }catch(e){ showJSON('fkOutLeft', {error:String(e)}); }
      finally{ setBtnLoading($('btnEmailPosture'), false); }
    });

    // DKIM
    $('btnDkim').addEventListener('click', async ()=>{
      const key=getKey(); if(!key){alert('Ingresa tu Org API Key');return;}
      const dom=$('fkDomain').value.trim();
      const sel=$('fkDkimSelector').value.trim();
      if(!dom || !sel){ showJSON('fkOutLeft', {error:'Ingresa domain y selector'}); return; }
      const qname=`${sel}._domainkey.${dom}`;
      setBtnLoading($('btnDkim'), true);
      showPlaceholder('fkOutLeft',`Consultando TXT en ${qname}â€¦`);
      try{
        const res = await fetch(`${API_BASE}/noc/dns-lookup`, {
          method:'POST',
          headers:{'x-api-key':key,'content-type':'application/json','accept':'application/json'},
          body: JSON.stringify({ domain:qname, type:'TXT' })
        });
        const data = await res.json();
        showJSON('fkOutLeft', data);
      }catch(e){ showJSON('fkOutLeft', {error:String(e)}); }
      finally{ setBtnLoading($('btnDkim'), false); }
    });

    // TLS
    $('btnTls').addEventListener('click', async ()=>{
      const key=getKey(); if(!key){alert('Ingresa tu Org API Key');return;}
      const host=$('fkTlsHost').value.trim(); const port=parseInt(($('fkTlsPort').value||'443'),10);
      if(!host || !port){ showJSON('fkOutLeft',{error:'Ingresa host y puerto'}); return; }
      setBtnLoading($('btnTls'), true);
      showPlaceholder('fkOutLeft','Runningâ€¦');
      try{
        const res = await fetch(`${API_BASE}/ext/tls`, {
          method:'POST',
          headers:{'x-api-key':key,'content-type':'application/json','accept':'application/json'},
          body: JSON.stringify({ host, port })
        });
        const data = await res.json();
        showJSON('fkOutLeft', data);
      }catch(e){ showJSON('fkOutLeft', {error:String(e)}); }
      finally{ setBtnLoading($('btnTls'), false); }
    });

    // Service check (portscan + optional http-check)
    $('btnSvc').addEventListener('click', async ()=>{
      const key=getKey(); if(!key){alert('Ingresa tu Org API Key');return;}
      const host=$('fkHost').value.trim(); const url=$('fkUrl').value.trim();
      const ports=parsePorts($('fkPorts').value);
      if(!host && !url){ showJSON('fkOutRight',{error:'Ingresa host y/o URL'}); return; }

      setBtnLoading($('btnSvc'), true);
      showPlaceholder('fkOutRight','Runningâ€¦');

      const headers={'x-api-key':key,'content-type':'application/json','accept':'application/json'};
      const results={};

      try{
        if(ports.length && host){
          const res = await fetch(`${API_BASE}/network/portscan`, {
            method:'POST', headers, body: JSON.stringify({ host, ports, timeout_ms:500 })
          });
          results.portscan = await res.json();
        }
        if(url){
          const res = await fetch(`${API_BASE}/noc/http-check`, {
            method:'POST', headers, body: JSON.stringify({ url, timeout_s:8, verify_tls:true })
          });
          results.http_check = await res.json();
        }
        showJSON('fkOutRight', results);
      }catch(e){
        showJSON('fkOutRight', {error:String(e), partial:results});
      }finally{
        setBtnLoading($('btnSvc'), false);
      }
    });

    // Placeholders iniciales
    showPlaceholder('fkOutLeft'); showPlaceholder('fkOutRight');
  })();
  </script>

  <!-- ============================ [NEW] ============================ -->
  <!-- Carga del header/footer centralizados -->
  <script defer src="/js/nav.js"></script>
  <script defer src="/js/footer.js"></script>
  <!-- ========================== [/NEW] ============================ -->
  <script src="/js/fix-nav.js" defer></script>

</body>
</html>

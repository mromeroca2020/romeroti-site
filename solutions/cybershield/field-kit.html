<!DOCTYPE html>
<html lang="en">
<head>
  <!-- =========================================================
    Archivo: /solutions/cybershield/field-kit.html  (o .../index.html)
    Propósito: "Field Kit" para demos/assessment rápido.
    Claves:
    - Favicons RomanoTI unificados
    - Navbar estándar con dropdown "Solutions"
    - Estilo de marca (gradiente azul, botones)
    - Hotfix universal del menú (/js/fix-nav.js) + fallback local
    - Lógica del Field Kit (tu JS) respetada
  ========================================================== -->
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>CyberShield Field Kit | RomanoTI Solutions</title>

  <!-- Favicons (RomanoTI) -->
  <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png?v=3">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32.png?v=3">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16.png?v=3">
  <link rel="icon" href="/favicon.ico?v=3" sizes="any">
  <link rel="mask-icon" href="/img/safari-pinned-tab.svg?v=3" color="#2563eb">
  <meta name="theme-color" content="#2563eb">

  <!-- Tailwind + Fuente -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Estilos RomanoTI (colores y componentes) -->
  <style>
    :root{
      --rt-primary:#2563eb;
      --rt-primary-hover:#1d4ed8;
      --rt-ink:#0f172a;
      --rt-code:#0e1116;
    }
    body{font-family:'Montserrat',sans-serif;background:#f8f9fa;color:var(--rt-ink)}
    .hero-bg{background:linear-gradient(135deg,#1e3a8a 0%,#2563eb 100%)}
    .btn-primary{background:var(--rt-primary);transition:all .2s}
    .btn-primary:hover{background:var(--rt-primary-hover);transform:translateY(-1px)}
    .badge{display:inline-block;border:1px solid #cbd5e1;border-radius:999px;padding:4px 10px;font-size:12px;background:#f8fafc}
    .card{border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 10px 30px -12px rgba(0,0,0,.12)}
    pre.fieldkit-out{background:var(--rt-code);color:#eaeef3;padding:12px;border-radius:10px;max-height:46vh;overflow:auto}
    .dropdown{display:none}
    .dropdown.show{display:block}
  </style>
</head>
<body class="bg-gray-50">

  <!-- =================== NAVBAR =================== -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-6 py-3">
      <div class="flex items-center justify-between">
        <!-- Logo -->
        <a href="/" class="flex items-center font-bold text-xl">
          <span class="bg-blue-600 text-white rounded-full w-10 h-10 grid place-items-center mr-3">R</span>
          RomanoTI Solutions
        </a>

        <!-- Menú desktop -->
        <nav class="hidden md:flex items-center space-x-8">
          <a href="/" class="text-gray-700 hover:text-blue-600 font-medium">Home</a>

          <!-- Dropdown Solutions (compatible con fix-nav.js) -->
          <div class="relative">
            <button id="solutionsBtn" class="text-gray-900 font-semibold inline-flex items-center focus:outline-none">
              Solutions
              <svg class="ml-1 w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 10.58l3.71-3.35a.75.75 0 111.02 1.1l-4.2 3.79a.75.75 0 01-1.02 0l-4.2-3.79a.75.75 0 01.02-1.06z" clip-rule="evenodd"/>
              </svg>
            </button>
            <div id="solutionsMenu" class="dropdown absolute right-0 mt-2 w-64 rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5">
              <a href="/solutions/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Overview</a>
              <a href="/solutions/cybershield/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">CyberShield (MDR)</a>
              <a href="/solutions/cybershield/soc-console.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">SOC Console</a>
              <a href="/solutions/cybershield/easm-console.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">EASM Console</a>
              <a href="/solutions/cybershield/field-kit.html" class="block px-4 py-2 text-sm text-blue-700 bg-gray-50 font-semibold">Field Kit</a>
            </div>
          </div>

          <a href="/services/tools.html" class="text-gray-700 hover:text-blue-600 font-medium">Tools</a>
          <a href="/it-noc.html" class="text-gray-700 hover:text-blue-600 font-medium">NOC</a>
          <a href="/it-soc.html" class="text-gray-700 hover:text-blue-600 font-medium">SOC</a>
          <a href="https://calendly.com/mauricioromeroca" class="btn-primary text-white px-5 py-2 rounded-lg font-medium">Book Now</a>
        </nav>

        <!-- Mobile atajo -->
        <div class="md:hidden">
          <a href="/" class="text-gray-700 mr-4">Home</a>
          <a href="/solutions/" class="btn-primary text-white px-4 py-2 rounded-lg">Solutions</a>
        </div>
      </div>
    </div>
  </header>

  <!-- =================== HERO =================== -->
  <section class="hero-bg text-white">
    <div class="container mx-auto px-6 py-10">
      <h1 class="text-3xl md:text-4xl font-bold">CyberShield Field Kit</h1>
      <p class="text-lg md:text-xl mt-2">Chequeos rápidos para demos y assessment inicial. Usa tu <code>x-api-key</code>.</p>
    </div>
  </section>

  <!-- =================== CONTENIDO =================== -->
  <section class="container mx-auto px-6">
    <!-- API Key -->
    <div class="card bg-white p-6 mt-6">
      <label class="block text-sm font-medium text-gray-700 mb-1">Org API Key (<code>x-api-key</code>)</label>
      <div class="flex flex-col md:flex-row gap-3 items-start md:items-center">
        <div class="flex items-center gap-2 w-full md:w-auto">
          <input id="fkKey" type="password" class="w-[380px] max-w-full border rounded-lg px-3 py-2" placeholder="pega tu API key">
          <label class="text-sm text-gray-600 inline-flex items-center gap-1">
            <input id="fkKeyShow" type="checkbox" class="rounded border-gray-300">
            <span>mostrar</span>
          </label>
        </div>
        <div class="flex gap-3">
          <button id="btnSaveKey" class="btn-primary text-white px-5 py-2 rounded-lg font-medium">Guardar</button>
          <button id="btnClearKey" class="px-5 py-2 rounded-lg font-medium border">Clear</button>
        </div>
      </div>
      <p id="fkKeyMsg" class="text-sm text-gray-500 mt-2"></p>
    </div>

    <div class="grid md:grid-cols-2 gap-6 mt-6">
      <!-- Left: External posture -->
      <div class="card bg-white p-6">
        <h2 class="text-xl font-bold mb-4">External Posture</h2>

        <label class="block text-sm font-medium text-gray-700">Domain</label>
        <input id="fkDomain" class="w-full border rounded-lg px-3 py-2 mb-3" placeholder="example.com" value="example.com">

        <div class="flex flex-wrap gap-3">
          <button id="btnEmailPosture" class="btn-primary text-white px-4 py-2 rounded-lg font-medium">
            Email Posture (MX/SPF/DMARC)
          </button>
        </div>

        <div class="grid md:grid-cols-2 gap-3 mt-5">
          <div>
            <label class="block text-sm font-medium text-gray-700">DKIM selector</label>
            <input id="fkDkimSelector" class="w-full border rounded-lg px-3 py-2" placeholder="selector1">
          </div>
          <div class="flex items-end">
            <button id="btnDkim" class="btn-primary text-white px-4 py-2 rounded-lg font-medium w-full">DKIM TXT lookup</button>
          </div>
        </div>

        <div class="grid md:grid-cols-6 gap-3 mt-6">
          <div class="md:col-span-4">
            <label class="block text-sm font-medium text-gray-700">TLS host</label>
            <input id="fkTlsHost" class="w-full border rounded-lg px-3 py-2" placeholder="example.com" value="example.com">
          </div>
          <div class="md:col-span-1">
            <label class="block text-sm font-medium text-gray-700">Port</label>
            <input id="fkTlsPort" type="number" min="1" max="65535" value="443" class="w-full border rounded-lg px-3 py-2">
          </div>
          <div class="md:col-span-1 flex items-end">
            <button id="btnTls" class="btn-primary text-white px-4 py-2 rounded-lg font-medium w-full">TLS Cert Check</button>
          </div>
        </div>

        <pre id="fkOutLeft" class="fieldkit-out hidden mt-4"></pre>
      </div>

      <!-- Right: Service check -->
      <div class="card bg-white p-6">
        <h2 class="text-xl font-bold mb-4">Service Check (host/url)</h2>

        <div class="grid md:grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium text-gray-700">Host</label>
            <input id="fkHost" class="w-full border rounded-lg px-3 py-2" placeholder="8.8.8.8">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">URL (opcional)</label>
            <input id="fkUrl" class="w-full border rounded-lg px-3 py-2" placeholder="https://tu-sitio.com">
          </div>
        </div>

        <label class="block text-sm font-medium text-gray-700 mt-3">Puertos rápidos (coma)</label>
        <input id="fkPorts" class="w-full border rounded-lg px-3 py-2" value="22,80,443,3389,445,25,587">

        <div class="mt-3">
          <button id="btnSvc" class="btn-primary text-white px-4 py-2 rounded-lg font-medium">Ejecutar</button>
        </div>

        <pre id="fkOutRight" class="fieldkit-out hidden mt-4"></pre>
      </div>
    </div>
  </section>

  <!-- =================== FOOTER =================== -->
  <footer class="bg-gray-900 text-white py-8 mt-10">
    <div class="container mx-auto px-6 text-center">
      <p>© 2025 RomanoTI Solutions. All rights reserved.</p>
      <p class="mt-2">Serving Canada</p>
    </div>
  </footer>

  <!-- =================== SCRIPTS =================== -->

  <!-- Fallback de dropdown (por compatibilidad con .dropdown/.show).
       fix-nav.js hará el manejo unificado, pero dejamos esto por si
       fallara el defer/orden de carga. -->
  <script>
    (function(){
      const btn=document.getElementById('solutionsBtn');
      const menu=document.getElementById('solutionsMenu');
      if(!btn||!menu) return;
      const toggle=()=>menu.classList.toggle('show');
      const close =()=>menu.classList.remove('show');
      btn.addEventListener('click',(e)=>{e.preventDefault();e.stopPropagation();toggle();});
      document.addEventListener('click',(e)=>{ if(!menu.contains(e.target) && e.target!==btn) close();});
      document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') close(); });
    })();
  </script>

  <!-- Lógica del Field Kit (tu JS tal cual, sólo con comentarios de sección) -->
  <script>
  (function(){
    const API_BASE = 'https://romanoti-tools-api.onrender.com';
    const $ = (id)=>document.getElementById(id);

    function showPlaceholder(preId, text='No output yet'){
      const el=$(preId); el.textContent=text; el.classList.remove('hidden'); el.classList.add('muted');
    }
    function showJSON(preId, data){
      const el=$(preId); el.classList.remove('muted','hidden');
      try{ el.textContent = JSON.stringify(data, null, 2); }catch{ el.textContent = String(data); }
    }
    function setBtnLoading(btn, isLoading, label){
      if(!btn) return;
      btn.disabled = !!isLoading;
      if(isLoading){ btn.dataset._label = btn.textContent; btn.textContent = label || 'Running…'; }
      else { btn.textContent = btn.dataset._label || btn.textContent; }
    }
    function parsePorts(s){
      return (s||'').split(',').map(x=>x.trim()).filter(Boolean)
        .map(x=>parseInt(x,10)).filter(x=>Number.isInteger(x)&&x>0&&x<=65535).slice(0,50);
    }
    function getKey(){
      return $('fkKey').value.trim() || localStorage.getItem('romanoti_org_key') || '';
    }

    // Cargar/guardar/eliminar key
    (function initKey(){
      const saved = localStorage.getItem('romanoti_org_key') || '';
      if(saved) {$('fkKey').value = saved; $('fkKeyMsg').textContent='✅ API key cargada desde tu navegador.';}
      $('fkKeyShow').addEventListener('change', (e)=>{ $('fkKey').type = e.target.checked ? 'text' : 'password'; });
      $('btnSaveKey').addEventListener('click', ()=>{
        const v=$('fkKey').value.trim(); localStorage.setItem('romanoti_org_key', v);
        $('fkKeyMsg').textContent = v ? '✅ Guardada localmente.' : 'API Key vacía.';
      });
      $('btnClearKey').addEventListener('click', ()=>{
        localStorage.removeItem('romanoti_org_key'); $('fkKey').value=''; $('fkKeyMsg').textContent='🔒 Key eliminada del navegador.';
      });
    })();

    // Email posture
    $('btnEmailPosture').addEventListener('click', async ()=>{
      const key=getKey(); if(!key){alert('Ingresa tu Org API Key');return;}
      const domain=$('fkDomain').value.trim(); if(!domain){showJSON('fkOutLeft',{error:'Ingresa domain'});return;}
      setBtnLoading($('btnEmailPosture'), true);
      showPlaceholder('fkOutLeft','Running…');
      try{
        const res = await fetch(`${API_BASE}/ext/emaildns`, {
          method:'POST',
          headers:{'x-api-key':key,'content-type':'application/json','accept':'application/json'},
          body: JSON.stringify({ domain })
        });
        const data = await res.json();
        showJSON('fkOutLeft', data);
      }catch(e){ showJSON('fkOutLeft', {error:String(e)}); }
      finally{ setBtnLoading($('btnEmailPosture'), false); }
    });

    // DKIM
    $('btnDkim').addEventListener('click', async ()=>{
      const key=getKey(); if(!key){alert('Ingresa tu Org API Key');return;}
      const dom=$('fkDomain').value.trim();
      const sel=$('fkDkimSelector').value.trim();
      if(!dom || !sel){ showJSON('fkOutLeft', {error:'Ingresa domain y selector'}); return; }
      const qname=`${sel}._domainkey.${dom}`;
      setBtnLoading($('btnDkim'), true);
      showPlaceholder('fkOutLeft',`Consultando TXT en ${qname}…`);
      try{
        const res = await fetch(`${API_BASE}/noc/dns-lookup`, {
          method:'POST',
          headers:{'x-api-key':key,'content-type':'application/json','accept':'application/json'},
          body: JSON.stringify({ domain:qname, type:'TXT' })
        });
        const data = await res.json();
        showJSON('fkOutLeft', data);
      }catch(e){ showJSON('fkOutLeft', {error:String(e)}); }
      finally{ setBtnLoading($('btnDkim'), false); }
    });

    // TLS
    $('btnTls').addEventListener('click', async ()=>{
      const key=getKey(); if(!key){alert('Ingresa tu Org API Key');return;}
      const host=$('fkTlsHost').value.trim(); const port=parseInt(($('fkTlsPort').value||'443'),10);
      if(!host || !port){ showJSON('fkOutLeft',{error:'Ingresa host y puerto'}); return; }
      setBtnLoading($('btnTls'), true);
      showPlaceholder('fkOutLeft','Running…');
      try{
        const res = await fetch(`${API_BASE}/ext/tls`, {
          method:'POST',
          headers:{'x-api-key':key,'content-type':'application/json','accept':'application/json'},
          body: JSON.stringify({ host, port })
        });
        const data = await res.json();
        showJSON('fkOutLeft', data);
      }catch(e){ showJSON('fkOutLeft', {error:String(e)}); }
      finally{ setBtnLoading($('btnTls'), false); }
    });

    // Service check (portscan + optional http-check)
    $('btnSvc').addEventListener('click', async ()=>{
      const key=getKey(); if(!key){alert('Ingresa tu Org API Key');return;}
      const host=$('fkHost').value.trim(); const url=$('fkUrl').value.trim();
      const ports=parsePorts($('fkPorts').value);
      if(!host && !url){ showJSON('fkOutRight',{error:'Ingresa host y/o URL'}); return; }

      setBtnLoading($('btnSvc'), true);
      showPlaceholder('fkOutRight','Running…');

      const headers={'x-api-key':key,'content-type':'application/json','accept':'application/json'};
      const results={};

      try{
        if(ports.length && host){
          const res = await fetch(`${API_BASE}/network/portscan`, {
            method:'POST', headers, body: JSON.stringify({ host, ports, timeout_ms:500 })
          });
          results.portscan = await res.json();
        }
        if(url){
          const res = await fetch(`${API_BASE}/noc/http-check`, {
            method:'POST', headers, body: JSON.stringify({ url, timeout_s:8, verify_tls:true })
          });
          results.http_check = await res.json();
        }
        showJSON('fkOutRight', results);
      }catch(e){
        showJSON('fkOutRight', {error:String(e), partial:results});
      }finally{
        setBtnLoading($('btnSvc'), false);
      }
    });

    // Placeholders iniciales
    showPlaceholder('fkOutLeft'); showPlaceholder('fkOutRight');
  })();
  </script>

  <!-- Hotfix universal de navegación -->
  <script src="/js/fix-nav.js" defer></script>
</body>
</html>
